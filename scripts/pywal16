#!/usr/bin/env bash


ln -sf ~/.cache/wal/colors.Xresources ~/.Xresources
cat ~/.Xresources ~/.cache/wal/xrdb_extra | xrdb -merge
xdotool key super+w # xrdb refresh keybind

background=$(jq -r '.special.background' ~/.cache/wal/colors.json)
foreground=$(jq -r '.special.foreground' ~/.cache/wal/colors.json)
frame_color=$(jq -r '.colors.color1' ~/.cache/wal/colors.json)

# --- Ensure directories exist ---
mkdir -p ~/.config/dunst

# --- Write Dunst config ---
cat <<EOF > ~/.config/dunst/dunstrc
[global]
    font = Jetbrains Mono NerdFont 11
    min_icon_size = 32
    max_icon_size = 32
    transparency = 35
    timeout = 10
    origin = top-right
    padding = 9
    frame_width = 4
    separator_height = 2
    background = "$background"
    foreground = "$foreground"
    frame_color = "$frame_color"

[urgency_low]
    background = "#444444"
    foreground = "#bbbbbb"
    frame_color = "#444444"
    timeout = 3

[urgency_normal]
    background = "$background"
    foreground = "$foreground"
    frame_color = "$frame_color"
    timeout = 5

[urgency_critical]
    background = "#ff0000"
    foreground = "#ffffff"
    frame_color = "#ff0000"
    timeout = 15
EOF

# --- Restart services safely ---
pkill dunst && dunst &
sleep 0.2

notify-send "Wallpaper, Pywal and Dunst updated safely"
